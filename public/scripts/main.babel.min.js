"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};var dateCooked=function dateCooked(d){var c=new Date(d);var a=new Date();var b=a-c;if(b<3600000){return Math.round(b/60000)+" minutes ago"}else{if(b<86400000){return Math.round(b/3600000)+" hours ago"}else{if(b<604800000){return Math.round(b/86400000)+" days ago"}else{return c.toLocaleDateString()}}}};var localStorage=window.localStorage;var isEmpty=function isEmpty(a){if(a==null||a==""){return true}return false};var isUndefined=function isUndefined(a){if(a===undefined){return true}return false};var isOutdated=function isOutdated(a){if(!isUndefined(typeof localStorage==="undefined"?"undefined":_typeof(localStorage))&&getSessionRefreshSearch()=="true"){return true}else{if(getSessionSearchText()!=getURLRequestSearchText()){return true}else{var b=localStorage.getItem("tfLastSaved");if(b!=null){return(a-b)/3600000>1}}}return true};var getURLRequestSearchText=function getURLRequestSearchText(){var c="";var a=window.location;var b=a.pathname.substr(1);if(b.length>0){c=b}return c};var getSessionSearchText=function getSessionSearchText(){var a="";if(!isUndefined(typeof localStorage==="undefined"?"undefined":_typeof(localStorage))&&localStorage.getItem("tfSearchText")!==null){a=localStorage.getItem("tfSearchText")}return a};var getSessionRefreshSearch=function getSessionRefreshSearch(){var a=undefined;if(!isUndefined(typeof localStorage==="undefined"?"undefined":_typeof(localStorage))&&localStorage.getItem("tfRefreshSearch")!==null){a=localStorage.getItem("tfRefreshSearch")}return a};var isJSON=function isJSON(b){try{JSON.parse(b)}catch(a){return false}return true};var showErrorMsg=function showErrorMsg(a){if(a.length>0){alert("Your search: "+a+" did not return any result.")}else{alert("Your search did not return any result.")}};var isSearchInputFocused=function isSearchInputFocused(){return $("#searchInput").is(":focus")};var backendURL="http://api.tagfeeds.com/newsBing";var keyId=0;var NavBox=React.createClass({displayName:"NavBox",getData:function getData(){var a=getSessionSearchText();var c=a==undefined?[undefined]:a.split(",");var b=[];var d=0;c.forEach(function(e){b[d++]={search:e}});this.setState({tagList:b})},removeTag:function removeTag(d){var c=this.state.tagList;for(var b=0;b<c.length;b++){var a=c[b];if(a.search===encodeURI(d)){c.splice(b,1)}}this.setState({tagList:c})},componentDidMount:function componentDidMount(){var a=this;a.getData();$(function(){$("#searchForm").submit(function(){return false});$("#searchInput").keypress(function(d){var f=$(this);if(d.keyCode==13){var c=f.val();if(c!=getURLRequestSearchText()){localStorage.setItem("tfRefreshSearch",true)}else{localStorage.setItem("tfRefreshSearch",false)}localStorage.setItem("tfSearchText",c);var b=window.location.origin;window.location.replace(b+"/"+c)}});$("#searchInput").mousedown(function(){$("meta[name=viewport]").remove();$("head").append('<meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=0">')});$("#searchInput").focusout(function(){$("meta[name=viewport]").remove();$("head").append('<meta name="viewport" content="width=device-width, initial-scale=1.0">')});$('.has-clear input[type="text"]').on("input propertychange",function(){var b=$(this);var c=Boolean(b.val());b.siblings(".form-control-clear").toggleClass("hidden",!c)}).trigger("propertychange");$(".form-control-clear").click(function(){$("#searchInput").mousedown();$(this).siblings('input[type="text"]').val("").trigger("propertychange").focus()})})},render:function render(){return React.createElement("nav",{className:"navbar navbar-inverse navbar-fixed-top"},React.createElement("div",{className:"container-fluid"},React.createElement("div",{className:"navbar-header"},React.createElement("a",{className:"navbar-brand",href:"#"},React.createElement("img",{src:"images/brandTf.png"})),React.createElement("button",{id:"navbar-toggle",type:"button",className:"navbar-toggle collapsed","data-toggle":"collapse","data-target":"#navbar","aria-expanded":"false","aria-controls":"navbar"},React.createElement("span",{className:"sr-only"},"Toggle navigation"),React.createElement("span",{className:"icon-bar"}),React.createElement("span",{className:"icon-bar"}),React.createElement("span",{className:"icon-bar"}))),React.createElement("div",{id:"navbar",className:"navbar-collapse collapse","aria-expanded":"false"},React.createElement("ul",{className:"nav navbar-nav navbar-left"},React.createElement("form",{id:"searchForm",className:"navbar-form navbar-left has-feedback has-clear",role:"form",action:"."},React.createElement("div",{className:"form-group"},React.createElement("input",{id:"searchInput",type:"text",name:"search",className:"form-control",placeholder:"Search"}),React.createElement("span",{className:"form-control-clear glyphicon glyphicon-remove-circle form-control-feedback translucent"})),React.createElement("div",{className:"bootstrap-tagsinput",id:"tagCollection"},this.state!=null&&this.state.tagList.map(function(a,c){var e=decodeURI(a.search);var f=c+e;var d="tag:"+f;var b="tagRemove:"+f;if(e!=""){return React.createElement("span",{id:d,key:d,className:"tag label"},e,React.createElement("span",{id:b,key:b,"data-role":"remove",onClick:this.removeTag.bind(this,e)}))}},this)))))))}});var MainBox=React.createClass({displayName:"MainBox",getInitialState:function getInitialState(){return{data:undefined}},fetchNewsFeeds:function fetchNewsFeeds(e){var d=e;var a=getURLRequestSearchText();var b=getSessionSearchText();var c=getSessionRefreshSearch();if(isEmpty(e)){if(!isEmpty(a)){d=a}else{d=b}}var f=isEmpty(d)?backendURL:backendURL+"?search="+d;this.serverRequest=$.ajax({url:f,dataType:"json",cache:true,timeout:5000,success:function(h){if(h.length>0){if(!isUndefined(typeof localStorage==="undefined"?"undefined":_typeof(localStorage))){try{localStorage.setItem("tfData",JSON.stringify(h));localStorage.setItem("tfLastSaved",new Date().getTime());localStorage.setItem("tfSearchText",d);localStorage.setItem("tfRefreshSearch",false)}catch(g){console.log(g.toString())}}this.setState({data:h});this.getNewsBoxData();this.getNavBoxData()}else{showErrorMsg(d)}}.bind(this),error:function(i,g,h){console.log(backendURL,g,h.toString())}.bind(this)})},componentDidMount:function componentDidMount(){var a=new Date().getTime();if(isOutdated(a)){this.fetchNewsFeeds()}else{var b=localStorage.getItem("tfData");if(b!=null&&isJSON(b)){this.setState({data:JSON.parse(b)})}else{showErrorMsg("")}}},componentWillUnmount:function componentWillUnmount(){this.serverRequest.abort()},getNewsBoxData:function getNewsBoxData(){this.refs.newsBox.getData()},getNavBoxData:function getNavBoxData(){this.refs.navBox.getData()},render:function render(){if(this.state.data==undefined){return React.createElement("div",null,React.createElement(NavBox,{ref:"navBox",callbackParent:this.fetchNewsFeeds}))}else{return React.createElement("div",null,React.createElement(NavBox,{ref:"navBox",callbackParent:this.fetchNewsFeeds}),React.createElement("div",{id:"carousel-example-generic",className:"carousel slide","data-ride":"carousel","data-interval":"false"},React.createElement("ol",{className:"carousel-indicators"},this.state.data.map(function(c,b){var f=c.title.length;var a=this.getNewsBoxData.bind(this,b);var d=b==0?"active":" ";var e="carouselIndicatorsKeyId"+f+"_"+b;return React.createElement("li",{"data-target":"#carousel-example-generic",onClick:a,"data-slide-to":b,className:d,key:e})},this)),React.createElement("div",{className:"carousel-inner",role:"listbox"},this.state.data.map(function(h,c){var e=h.title.length;var j=e+"_"+c;var b=c==0?"item active":"item";var d="carouselInnerParentDivId"+j;var a="carouselInnerImageId"+j;var g="carouselInnerDivId"+j;var k="carouselInnerNewsBg"+j;var i="carouselInnerBlackOverlay"+j;var f={background:'url("'+this.state.data[c].image+'")'};return React.createElement("div",{className:b,key:d},React.createElement("img",{src:"images/spacer.png",height:"100%",width:"100%",key:a}),React.createElement("div",{key:g},React.createElement("div",{id:"newsBg",style:f,key:k}),React.createElement("div",{id:"blackOverlay",key:i})))},this))),React.createElement(NewsBox,{ref:"newsBox",data:this.state.data}))}}});var NewsBox=React.createClass({displayName:"NewsBox",getData:function getData(){var a=$(".carousel").find(".active").index();if(a==-1){a=0}this.setState({index:a,currentData:this.props.data[a]})},getInitialState:function getInitialState(){return{index:0,currentData:this.props.data[0]}},updateMetaData:function updateMetaData(){$('meta[property="og:type"]').attr("content","article");$('meta[property="og:site_name"]').attr("content",this.state.currentData.newsSrc);$('meta[property="og:title"]').attr("content","TAGfeeds: "+this.state.currentData.title);$('meta[property="og:image"]').attr("content",this.state.currentData.image);$('meta[property="og:url"]').attr("content",this.state.currentData.link);$('meta[property="og:description"]').attr("content",this.state.currentData.description);$('meta[name="twitter:title"]').attr("content","TAGfeeds: "+this.state.currentData.title);$('meta[name="twitter:description"]').attr("content",this.state.currentData.description);$('meta[name="twitter:image"]').attr("content",this.state.currentData.image)},componentDidMount:function componentDidMount(){var a=this;$(function(){$("body").keydown(function(c){var b=c.which;if(!isSearchInputFocused()&&b==37){$("#carousel-left").click();a.getData()}else{if(!isSearchInputFocused()&&b==39){$("#carousel-right").click();a.getData()}}})});this.updateMetaData()},componentDidUpdate:function componentDidUpdate(){this.updateMetaData()},render:function render(){return React.createElement("div",null,React.createElement("div",{id:"newsFg",className:"article"},React.createElement("table",{id:"news"},React.createElement("colgroup",null,React.createElement("col",{className:"table-col"}),React.createElement("col",null),React.createElement("col",{className:"table-col"})),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null),React.createElement("td",{id:"logoRow"},React.createElement("img",{src:"images/logoTfMed.png"})),React.createElement("td",null)),React.createElement("tr",{id:"newsSection"},React.createElement("td",null,React.createElement("span",{className:"glyphicon glyphicon-chevron-left glyphicon-padding","aria-hidden":"true"})),React.createElement("td",{id:"newsRow"},React.createElement("div",null,React.createElement("article",null,React.createElement("span",{id:"newsTitle"},React.createElement("a",{href:this.state.currentData.link,target:"_blank"},this.state.currentData.title)),React.createElement("br",null),React.createElement("span",{id:"newsSrc"},this.state.currentData.newsSrc),React.createElement("span",{id:"newsDate"}," - "+dateCooked(this.state.currentData.pubDate)),React.createElement("br",null),React.createElement("span",{id:"newsBody",className:"article1"},React.createElement("article1",null,this.state.currentData.description))),React.createElement("br",null),React.createElement("span",{id:"apiProvider"},React.createElement("img",{src:"images/brandBing.png"})))),React.createElement("td",null,React.createElement("span",{className:"glyphicon glyphicon-chevron-right glyphicon-padding","aria-hidden":"true"})))))),React.createElement("a",{id:"carousel-left",className:"left carousel-control",href:"#carousel-example-generic",role:"button","data-slide":"prev",onClick:this.getData}),React.createElement("a",{id:"carousel-right",className:"right carousel-control",href:"#carousel-example-generic",role:"button","data-slide":"next",onClick:this.getData}))}});ReactDOM.render(React.createElement(MainBox,{url:backendURL}),document.getElementById("content"));
